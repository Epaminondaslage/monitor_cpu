<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Servidor 10.0.0.139 - Monitor Profissional</title>

<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>

<h1>Dashboard Servidor 10.0.0.139</h1>

<div id="alert"></div>

<div class="grid">

<div class="card">
<h3>CPU Total (%)</h3>
<canvas id="cpuChart"></canvas>
</div>

<div class="card">
<h3>Load Average</h3>
<canvas id="loadChart"></canvas>
</div>

<div class="card">
<h3>Frigate CPU (%)</h3>
<canvas id="frigateChart"></canvas>
</div>

<div class="card">
<h3>Disk Read</h3>
<canvas id="diskChart"></canvas>
</div>

<div class="card">
<h3>CPU por Core</h3>
<canvas id="coreChart"></canvas>
</div>

<div class="card">
<h3>RAM</h3>
<div id="ram" class="indicator"></div>
</div>

<div class="card">
<h3>Temperatura SoC</h3>
<div id="temp" class="indicator"></div>
</div>

</div>

<script>

// =====================
// Função para criar gráfico linha
// =====================
function createLineChart(ctx,label,color,maxY=100){
    return new Chart(ctx,{
        type:'line',
        data:{
            labels:[],
            datasets:[{
                label:label,
                data:[],
                borderColor:color,
                backgroundColor:color,
                fill:false,
                tension:0.2
            }]
        },
        options:{
            animation:false,
            responsive:true,
            scales:{
                y:{
                    min:0,
                    max:maxY
                }
            }
        }
    });
}

// =====================
// Criando gráficos
// =====================
const cpuChart = createLineChart(
    document.getElementById('cpuChart'),
    'CPU %',
    '#38bdf8',
    100
);

const loadChart = createLineChart(
    document.getElementById('loadChart'),
    'Load',
    '#f43f5e',
    8
);

const frigateChart = createLineChart(
    document.getElementById('frigateChart'),
    'Frigate CPU',
    '#22c55e',
    200
);

const diskChart = createLineChart(
    document.getElementById('diskChart'),
    'Disk Read',
    '#facc15',
    100
);

// =====================
// Gráfico CPU por Core
// =====================
const coreChart = new Chart(
    document.getElementById('coreChart'),
    {
        type:'bar',
        data:{
            labels:[],
            datasets:[{
                label:'Uso %',
                data:[],
                backgroundColor:'#6366f1'
            }]
        },
        options:{
            animation:false,
            scales:{
                y:{
                    min:0,
                    max:100
                }
            }
        }
    }
);

// =====================
// Função para adicionar dados
// =====================
function addData(chart,value){
    const now = new Date().toLocaleTimeString();

    chart.data.labels.push(now);
    chart.data.datasets[0].data.push(value);

    if(chart.data.labels.length > 30){
        chart.data.labels.shift();
        chart.data.datasets[0].data.shift();
    }

    chart.update();
}

// =====================
// Atualização principal
// =====================
function update(){

fetch('api.php')
.then(r=>r.json())
.then(data=>{

// Linha
addData(cpuChart, data.cpu);
addData(loadChart, data.load);
addData(frigateChart, data.frigate_cpu);
addData(diskChart, data.disk_read);

// CPU por core
coreChart.data.labels = Object.keys(data.cores);
coreChart.data.datasets[0].data = Object.values(data.cores);
coreChart.update();

// Indicadores
document.getElementById('ram').innerText =
"RAM: " + data.ram_used + " MB / " + data.ram_total + " MB";

document.getElementById('temp').innerText =
"Temperatura: " + data.temp + " °C";

// Alerta
if(data.load > 5){
    document.getElementById('alert').innerHTML =
    "<div class='alert'>ALERTA: LOAD ALTO!</div>";
} else {
    document.getElementById('alert').innerHTML = "";
}

});
}

setInterval(update,3000);
update();

</script>

</body>
</html>